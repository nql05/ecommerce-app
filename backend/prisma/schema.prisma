generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model AddressInfo {
  LoginName          String      @db.VarChar(100)
  AddressID          Int         @default(autoincrement())
  ContactName        String      @db.VarChar(255)
  ContactPhoneNumber String      @db.Char(10)
  City               String      @db.VarChar(100)
  District           String      @db.VarChar(100)
  Commune            String      @db.VarChar(100)
  DetailAddress      String      @db.VarChar(500)
  AddressType        String      @default("Home", map: "DF__AddressIn__Addre__34C8D9D1") @db.VarChar(50)
  IsAddressDefault   Boolean     @default(false, map: "DF__AddressIn__IsAdd__36B12243")
  UserInfo           UserInfo    @relation(fields: [LoginName], references: [LoginName], onDelete: Cascade, map: "FK__AddressIn__Login__37A5467C")
  OrderInfo          OrderInfo[]

  @@id([LoginName, AddressID], map: "PK__AddressI__7B15A65FFE7DCCDE")
}

model AppliedVoucher {
  OrderID      Int
  SubOrderID   Int
  VoucherCode  String       @db.VarChar(10)
  Voucher      Voucher      @relation(fields: [VoucherCode], references: [Code], onDelete: Cascade, map: "FK__AppliedVo__Vouch__00200768")
  SubOrderInfo SubOrderInfo @relation(fields: [OrderID, SubOrderID], references: [OrderID, SubOrderID], onDelete: Cascade, map: "FK__AppliedVoucher__7F2BE32F")

  @@id([OrderID, SubOrderID, VoucherCode], map: "PK__AppliedV__476E502A5F93A8A3")
}

model Buyer {
  LoginName  String    @id(map: "PK__Buyer__DB8464FEBDFCBDF9") @db.VarChar(100)
  MoneySpent Int       @default(0, map: "DF__Buyer__MoneySpen__29572725")
  UserInfo   UserInfo  @relation(fields: [LoginName], references: [LoginName], onDelete: Cascade, map: "FK__Buyer__LoginName__2B3F6F97")
  Comment    Comment[]
}

model Cart {
  CartID    Int         @id(map: "PK__Cart__51BCD79753DDB33B") @default(autoincrement())
  LoginName String      @db.VarChar(100)
  TotalCost Int         @default(0, map: "DF__Cart__TotalCost__4F7CD00D")
  UserInfo  UserInfo    @relation(fields: [LoginName], references: [LoginName], onDelete: Cascade, map: "FK__Cart__LoginName__5070F446")
  StoredSKU StoredSKU[]
}

model Comment {
  CommentID       Int            @id(map: "PK__Comment__C3B4DFAAAAFE6342") @default(autoincrement())
  LoginName       String         @db.VarChar(100)
  ProductID       Int?
  SKUName         String?        @db.VarChar(100)
  Ratings         Int?
  Content         String?        @db.VarChar(500)
  ParentCommentID Int?
  SKU             SKU?           @relation(fields: [ProductID, SKUName], references: [ProductID, SKUName], onDelete: Cascade, map: "FK__Comment__6C190EBB")
  Buyer           Buyer          @relation(fields: [LoginName], references: [LoginName], onDelete: Cascade, map: "FK__Comment__LoginNa__6A30C649")
  Comment         Comment?       @relation("CommentToComment", fields: [ParentCommentID], references: [CommentID], onDelete: NoAction, onUpdate: NoAction, map: "FK__Comment__ParentC__6D0D32F4")
  other_Comment   Comment[]      @relation("CommentToComment")
  CommentImage    CommentImage[]
}

model CommentImage {
  CommentID  Int
  CommentURL String  @db.VarChar(200)
  Comment    Comment @relation(fields: [CommentID], references: [CommentID], onDelete: Cascade, map: "FK__CommentIm__Comme__6FE99F9F")

  @@id([CommentID, CommentURL], map: "PK__CommentI__6B1A7824C24E19DB")
}

model DeliveryMethod {
  MethodName      String            @id(map: "PK__Delivery__218CFB169741FD54") @db.VarChar(100)
  ProvideDelivery ProvideDelivery[]
  SubOrderInfo    SubOrderInfo[]
}

model DeliveryPartner {
  LoginName        String           @db.VarChar(100)
  ProviderName     String           @db.VarChar(100)
  UserInfo         UserInfo         @relation(fields: [LoginName], references: [LoginName], onUpdate: NoAction, map: "FK__DeliveryP__Login__0A9D95DB")
  DeliveryProvider DeliveryProvider @relation(fields: [ProviderName], references: [ProviderName], onUpdate: NoAction, map: "FK__DeliveryP__Provi__0B91BA14")

  @@id([LoginName, ProviderName], map: "PK__Delivery__8C5433303695B9A2")
}

model DeliveryProvider {
  ProviderName    String            @id(map: "PK__Delivery__7D057CE472EA955E") @db.VarChar(100)
  DeliveryPartner DeliveryPartner[]
  ProvideDelivery ProvideDelivery[]
  SubOrderInfo    SubOrderInfo[]
}

model FlatDiscountVoucher {
  Code           String @id(map: "PK__FlatDisc__A25C5AA6DC422F82") @db.VarChar(10)
  DiscountAmount Int    @default(0, map: "DF__FlatDisco__Disco__07C12930")
}

model OrderInfo {
  OrderID      Int            @id(map: "PK__OrderInf__C3905BAFE995EAF2") @default(autoincrement())
  LoginName    String         @db.VarChar(100)
  OrderDate    DateTime       @default(now(), map: "DF__OrderInfo__Order__3B75D760")
  TotalPrice   Int            @default(0, map: "DF__OrderInfo__Total__3C69FB99")
  ProviderName String         @default("VCB", map: "DF__OrderInfo__Provi__3D5E1FD2") @db.VarChar(100)
  AccountID    String?        @unique(map: "UQ__OrderInf__349DA58798F19B87") @db.VarChar(30)
  AddressID    Int
  AddressInfo  AddressInfo    @relation(fields: [LoginName, AddressID], references: [LoginName, AddressID], onDelete: Cascade, map: "FK__OrderInfo__3F466844")
  SubOrderInfo SubOrderInfo[]
}

model PercentageVoucher {
  Code               String  @id(map: "PK__Percenta__A25C5AA6CE5D8899") @db.VarChar(10)
  PercentageDiscount Decimal @default(0.0, map: "DF__Percentag__Perce__02FC7413") @db.Decimal(10, 2)
  MaxAmountAllowed   Int     @default(1, map: "DF__Percentag__MaxAm__03F0984C")
  Voucher            Voucher @relation(fields: [Code], references: [Code], onDelete: Cascade, map: "FK__Percentage__Code__04E4BC85")
}

model ProductInfo {
  ProductID          Int            @id(map: "PK__ProductI__B40CC6EDF8F1A2DD") @default(autoincrement())
  LoginName          String         @db.VarChar(100)
  ProductName        String         @db.VarChar(100)
  ProductBrand       String?        @db.VarChar(100)
  ProductCategory    String         @db.VarChar(100)
  ProductDescription String?        @db.VarChar(500)
  ProductMadeIn      String         @db.VarChar(100)
  Seller             Seller         @relation(fields: [LoginName], references: [LoginName], onDelete: Cascade, map: "FK__ProductIn__Login__571DF1D5")
  SKU                SKU[]
  VoucherOffer       VoucherOffer[]
}

model ProvideDelivery {
  ProviderName     String           @db.VarChar(100)
  MethodName       String           @db.VarChar(100)
  DeliveryMethod   DeliveryMethod   @relation(fields: [MethodName], references: [MethodName], onDelete: Cascade, map: "FK__ProvideDe__Metho__5441852A")
  DeliveryProvider DeliveryProvider @relation(fields: [ProviderName], references: [ProviderName], onDelete: Cascade, map: "FK__ProvideDe__Provi__534D60F1")

  @@id([ProviderName, MethodName], map: "PK__ProvideD__0F1DB355BAF294B4")
}

model Seller {
  LoginName     String        @id(map: "PK__Seller__DB8464FE4AF4049B") @db.VarChar(100)
  ShopName      String        @unique(map: "UQ__Seller__649A7D9637DB6A83") @db.VarChar(100)
  CitizenIDCard String        @unique(map: "UQ__Seller__029D5F14FFCE34BF") @db.VarChar(30)
  SellerName    String        @unique(map: "UQ__Seller__030470FA2973924E") @db.VarChar(50)
  MoneyEarned   Int           @default(0, map: "DF__Seller__MoneyEar__30F848ED")
  ProductInfo   ProductInfo[]
  UserInfo      UserInfo      @relation(fields: [LoginName], references: [LoginName], onDelete: Cascade, map: "FK__Seller__LoginNam__31EC6D26")
}

model SKU {
  ProductID      Int
  SKUName        String           @db.VarChar(100)
  Size           Int?
  Price          Int
  InStockNumber  Int
  Weight         Int?
  Comment        Comment[]
  ProductInfo    ProductInfo      @relation(fields: [ProductID], references: [ProductID], onUpdate: NoAction, map: "FK__SKU__ProductID__59FA5E80")
  SKUImage       SKUImage[]
  StoredSKU      StoredSKU[]
  SubOrderDetail SubOrderDetail[]

  @@id([ProductID, SKUName], map: "PK__SKU__5C8C537BC19E27BB")
}

model SKUImage {
  ProductID Int
  SKUName   String @db.VarChar(100)
  SKU_URL   String @db.VarChar(200)
  SKU       SKU    @relation(fields: [ProductID, SKUName], references: [ProductID, SKUName], onDelete: Cascade, map: "FK__SKUImage__66603565")

  @@id([ProductID, SKUName, SKU_URL], map: "PK__SKUImage__9389F47BB49FA8C3")
}

model StoredSKU {
  CartID    Int
  ProductID Int
  SKUName   String @db.VarChar(100)
  Quantity  Int    @default(0, map: "DF__StoredSKU__Quant__5CD6CB2B")
  SKU       SKU    @relation(fields: [ProductID, SKUName], references: [ProductID, SKUName], onDelete: Cascade, map: "FK__StoredSKU__5EBF139D")
  Cart      Cart   @relation(fields: [CartID], references: [CartID], onDelete: Cascade, map: "FK__StoredSKU__CartI__5DCAEF64")

  @@id([ProductID, CartID, SKUName], map: "PK__StoredSK__BF9F02CD001900C6")
}

model SubOrderDetail {
  OrderID      Int
  SubOrderID   Int
  ProductID    Int
  SKUName      String       @db.VarChar(100)
  Quantity     Int          @default(0, map: "DF__SubOrderD__Quant__619B8048")
  SubOrderInfo SubOrderInfo @relation(fields: [OrderID, SubOrderID], references: [OrderID, SubOrderID], onDelete: Cascade, map: "FK__SubOrderDetail__628FA481")
  SKU          SKU          @relation(fields: [ProductID, SKUName], references: [ProductID, SKUName], onDelete: Cascade, map: "FK__SubOrderDetail__6383C8BA")

  @@id([SubOrderID, SKUName], map: "PK__SubOrder__30908605AD49A4DC")
}

model SubOrderInfo {
  OrderID              Int
  SubOrderID           Int              @default(autoincrement())
  TotalSKUPrice        Int              @default(0, map: "DF__SubOrderI__Total__4222D4EF")
  ShippingStatus       String           @default("Preparing", map: "DF__SubOrderI__Shipp__4316F928") @db.VarChar(50)
  ActualDate           DateTime
  ExpectedDate         DateTime
  DeliveryMethodName   String           @db.VarChar(100)
  DeliveryProviderName String           @db.VarChar(100)
  DeliveryPrice        Int              @default(0, map: "DF__SubOrderI__Deliv__44FF419A")
  AppliedVoucher       AppliedVoucher[]
  SubOrderDetail       SubOrderDetail[]
  DeliveryMethod       DeliveryMethod   @relation(fields: [DeliveryMethodName], references: [MethodName], onDelete: Cascade, map: "FK__SubOrderI__Deliv__4BAC3F29")
  DeliveryProvider     DeliveryProvider @relation(fields: [DeliveryProviderName], references: [ProviderName], onDelete: Cascade, map: "FK__SubOrderI__Deliv__4CA06362")
  OrderInfo            OrderInfo        @relation(fields: [OrderID], references: [OrderID], onDelete: Cascade, map: "FK__SubOrderI__Order__45F365D3")

  @@id([OrderID, SubOrderID], map: "PK__SubOrder__EE115A96326FCCE5")
}

model UserInfo {
  LoginName       String            @id(map: "PK__UserInfo__DB8464FE22C3C945") @db.VarChar(100)
  Password        String            @db.VarChar(255)
  PhoneNumber     String?           @db.Char(10)
  Email           String?           @db.VarChar(255)
  UserName        String            @unique(map: "UQ__UserInfo__C9F284561B37EC4D") @db.VarChar(255)
  Gender          Boolean?
  BirthDate       DateTime?         @db.Date
  Age             Int?
  Address         String?           @db.VarChar(500)
  AddressInfo     AddressInfo[]
  Buyer           Buyer?
  Cart            Cart[]
  DeliveryPartner DeliveryPartner[]
  Seller          Seller?
  VoucherOffer    VoucherOffer[]
  Withdrawal      Withdrawal[]
}

model Voucher {
  VoucherID         Int                @unique(map: "UQ__Voucher__3AEE79C0D051CCBB") @default(autoincrement())
  Code              String             @id(map: "PK__Voucher__A25C5AA673A4AB80") @db.VarChar(10)
  StartedTime       DateTime
  ExpiredTime       DateTime
  CurrentUsedNumber Int                @default(0, map: "DF__Voucher__Current__73BA3083")
  MaxUsedNumber     Int                @default(1, map: "DF__Voucher__MaxUsed__74AE54BC")
  MinMoneyValue     Int                @default(0, map: "DF__Voucher__MinMone__75A278F5")
  AppliedVoucher    AppliedVoucher[]
  PercentageVoucher PercentageVoucher?
  VoucherOffer      VoucherOffer[]
}

model VoucherOffer {
  VoucherCode String      @db.VarChar(10)
  ProductID   Int
  LoginName   String      @db.VarChar(100)
  UserInfo    UserInfo    @relation(fields: [LoginName], references: [LoginName], onUpdate: NoAction, map: "FK__VoucherOf__Login__7C4F7684")
  ProductInfo ProductInfo @relation(fields: [ProductID], references: [ProductID], onUpdate: NoAction, map: "FK__VoucherOf__Produ__7B5B524B")
  Voucher     Voucher     @relation(fields: [VoucherCode], references: [Code], onDelete: Cascade, map: "FK__VoucherOf__Vouch__7A672E12")

  @@id([VoucherCode, ProductID], map: "PK__VoucherO__B44A70C628A6F3CF")
}

model Withdrawal {
  WithdrawalID     Int      @id(map: "PK__Withdraw__7C842C4E6F4CABF9") @default(autoincrement())
  LoginName        String   @db.VarChar(100)
  WithdrawalAmount Int
  WithdrawalTime   DateTime
  AccountID        String?  @unique(map: "UQ__Withdraw__349DA58757A84E77") @db.VarChar(30)
  ProviderName     String   @default("VCB", map: "DF__Withdrawa__Provi__10566F31") @db.VarChar(100)
  RemainingBalance Int      @default(0, map: "DF__Withdrawa__Remai__123EB7A3")
  UserInfo         UserInfo @relation(fields: [LoginName], references: [LoginName], onDelete: Cascade, map: "FK__Withdrawa__Login__0F624AF8")
}
